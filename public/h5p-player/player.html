<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>H5P Exercise</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, sans-serif; background: #fff; }
    #h5p-container { width: 100%; min-height: 200px; }
    .loading { display: flex; justify-content: center; align-items: center; height: 200px; color: #666; font-size: 16px; }
    .error { color: red; padding: 20px; text-align: center; }
  </style>
</head>
<body>
  <div id="h5p-container"><div class="loading">Lade Übung...</div></div>
  <script src="/h5p-player/main.bundle.js"></script>
  <script>
    (function() {
      var params = new URLSearchParams(window.location.search);
      var exerciseId = params.get('id');
      
      if (!exerciseId) {
        document.getElementById('h5p-container').innerHTML = '<div class="error">Keine Übungs-ID angegeben.</div>';
        return;
      }
      
      var el = document.getElementById('h5p-container');
      var options = {
        h5pJsonPath: '/api/public/h5p/' + exerciseId,
        frameJs: '/h5p-player/frame.bundle.js',
        frameCss: '/h5p-player/styles/h5p.css',
        librariesPath: '/h5p-libs',
        frame: false,
        copyright: false,
        export: false,
        icon: false,
        fullScreen: false
        // Default iframe embedType — this creates a proper iframe within this page
      };
      
      new H5PStandalone.H5P(el, options).then(function() {
        var loadingEl = document.querySelector('.loading');
        if (loadingEl) loadingEl.remove();
        
        // Auto-report height to parent
        function reportHeight() {
          var h = Math.max(
            document.documentElement.scrollHeight,
            document.body.scrollHeight,
            400
          );
          // Also check iframe inside
          var innerIframe = document.querySelector('iframe.h5p-iframe');
          if (innerIframe && innerIframe.contentDocument) {
            try {
              var innerH = innerIframe.contentDocument.documentElement.scrollHeight;
              if (innerH > h) h = innerH;
              // Fix inner iframe height too
              innerIframe.style.height = innerH + 'px';
            } catch(e) {}
          }
          window.parent.postMessage({ type: 'h5p-resize', height: h + 20 }, '*');
        }
        
        setTimeout(reportHeight, 500);
        setTimeout(reportHeight, 1500);
        setTimeout(reportHeight, 3000);
        setTimeout(reportHeight, 5000);
        setInterval(reportHeight, 2000);
      }).catch(function(err) {
        el.innerHTML = '<div class="error">Fehler beim Laden: ' + err.message + '</div>';
        console.error('H5P Error:', err);
      });
    })();
  </script>
</body>
</html>
